---
title: "Parte Pablo"
output: html_document
date: "2025-11-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Estudio relacionado con las variables relacionadas con el municipio

Primero vamos a ver la parte relacionada con TMUNI y LocalizaciónCentro
Como es un trbajo dedicacado al gasto en educación por hogar, vamos a agrupar primero todo por IDHOGAR. Después veremos el número total de cada tipo de municipio. Veremos también la relación con la localización del centro. Por último, veremos si existe una relación entre el tamaño del municipio y los gastos totales y lo mismo con la localización del centro.

```{r}
## Cuantos observables hay de cada tipo de municipio:
datos %>%
  count(TMUNI)

datos %>%
  count(Localización_Centro)

# Hay relación entre ambas????

tabla_rel_TMUNI_y_LocCen <- datos %>%
  select(TMUNI,Localización_Centro) %>%
  table()
tabla_rel_TMUNI_y_LocCen

chi2 <- chisq.test(tabla_rel_TMUNI_y_LocCen, correct= FALSE)
chi2

## Las variables TMUNI Y Localización_Centro son dependientes
```

```{r}
## Detección outliers
GastosxTMUNI <- datos %>%
  select(TMUNI, gasto_total_educacion, gasto_total_servicios, gasto_total_servicios_reglados, gasto_total_servicios_no_reglados, gasto_total_bienes) %>%
  pivot_longer(cols = starts_with("gasto_total"), names_to = "Tipo_Gasto", values_to = "Valor_Gasto")

Outlier_TMUNI <- GastosxTMUNI %>%
  group_by(Tipo_Gasto, TMUNI) %>%
  mutate(Q1 = quantile(Valor_Gasto, 0.25), Q3 = quantile(Valor_Gasto,0.75), IQR = IQR(Valor_Gasto), LimSup = Q3 + 1.5*IQR, LimInf = Q1 - 1.5*IQR) %>%
  filter(Valor_Gasto > LimSup | Valor_Gasto < LimInf) %>%
  ungroup() %>%
  arrange(Tipo_Gasto, TMUNI) %>%
  select(Tipo_Gasto, TMUNI, Valor_Gasto, LimInf, LimSup)
Outlier_TMUNI

```

```{r}
GastosxLocCen <- datos %>%
  select(Localización_Centro, gasto_total_educacion, gasto_total_servicios, gasto_total_servicios_reglados, gasto_total_servicios_no_reglados, gasto_total_bienes) %>%
  pivot_longer(cols = starts_with("gasto_total"), names_to = "Tipo_Gasto", values_to = "Valor_Gasto")

Outlier_LocCen <- GastosxLocCen %>%
  group_by(Tipo_Gasto, Localización_Centro) %>%
  mutate(Q1 = quantile(Valor_Gasto, 0.25), Q3 = quantile(Valor_Gasto,0.75), IQR = IQR(Valor_Gasto), LimSup = Q3 + 1.5*IQR, LimInf = Q1 - 1.5*IQR) %>%
  filter(Valor_Gasto > LimSup | Valor_Gasto < LimInf) %>%
  ungroup() %>%
  arrange(Tipo_Gasto, Localización_Centro) %>%
  select(Tipo_Gasto, Localización_Centro, Valor_Gasto, LimInf, LimSup)
Outlier_LocCen
```


```{r}
GastoMed_HogarxTMUNI <- datos %>% group_by(TMUNI) %>%
  summarise(Media_educación = mean(gasto_total_educacion), Media_servicios = mean(gasto_total_servicios), Media_servicios_reglados = mean(gasto_total_servicios_reglados), Media_servicios_noreglados = mean(gasto_total_servicios_no_reglados),Media_bienes = mean(gasto_total_bienes))
GastoMed_HogarxTMUNI

GastoMed_HogarxLocCen <- datos %>% group_by(Localización_Centro) %>%
  summarise(Media_educación = mean(gasto_total_educacion), Media_servicios = mean(gasto_total_servicios), Media_servicios_reglados = mean(gasto_total_servicios_reglados), Media_servicios_noreglados = mean(gasto_total_servicios_no_reglados),Media_bienes = mean(gasto_total_bienes))
GastoMed_HogarxLocCen
```

```{r}
## Representación gráfica 

GastosMedTMUNI <- GastoMed_HogarxTMUNI %>%
  pivot_longer(cols = starts_with("Media_"), names_to = "Tipo_Gasto", values_to = "Valor_Medio", names_prefix = "Media_")
head(GastosMedMUNI)

ggplot(GastosMedTMUNI, aes(x = TMUNI, y = Valor_Medio)) +
  geom_point(color = "blue", outlier.color = "red") +
  labs(title="Distribución Medias de Gasto por Tipo de Municipio", x= "Tipo de Municipio", y ="Media de Gasto") +
  facet_wrap(~Tipo_Gasto, ncol=2) +
  coord_flip() +
  theme_minimal()
```

```{r}
GastosMedLocCen <- GastoMedHogarxLocCen %>%
  pivot_longer(cols = starts_with("Media_"), names_to = "Tipo_Gasto", values_to = "Valor_Medio", names_prefix = "Media_")
head(GastosMedLocCen)

ggplot(GastosMedLocCen, aes(x = Localización_Centro, y = Valor_Medio)) +
  geom_point(color = "blue", outlier.color = "red") +
  labs(title="Distribución Medias de Gasto por Ubicación del Centro", x= "Ubicación del Centro", y ="Media de Gasto") +
  facet_wrap(~Tipo_Gasto, ncol = 2) +
  coord_flip() +
  theme_minimal()
```

```{r}

```


